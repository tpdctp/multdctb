async function checkAndUpdateData(t){try{const e=await fetch("https://db.jarviz.site/jarviz-tv/version.txt");if(!e.ok)throw new Error("Failed to fetch version");const a=await e.text();if(localStorage.getItem("cachedVersion")!==a){localStorage.clear();const e=await openDatabase();await fetchChannels(t),await fetchEPG(e,t),localStorage.setItem("cachedVersion",a)}}catch(t){throw console.error("Failed to check and update data:",t),t}}async function fetchChannels(t){try{const e=await fetch("https://db.jarviz.site/jarviz-tv/custom_channels.json");if(!e.ok)throw new Error("Failed to fetch channels");const a=await e.json(),o=await fetch("https://db.jarviz.site/jarviz-tv/custom_channels.json");if(!o.ok)throw new Error("Failed to fetch custom channels");const r=await o.json(),n=a.concat(r),c=Object.values(n);localStorage.setItem("cachedChannels",JSON.stringify(c)),t(50)}catch(t){throw console.error("Failed to fetch channels:",t),t}}async function fetchEPG(t,e){try{const a=await fetch("https://db.jarviz.site/jarviz-tv/epg.json");if(!a.ok)throw new Error("Failed to fetch EPG");const o=await a.json();await storeEPGData(t,o),e(100)}catch(t){throw console.error("Failed to fetch EPG:",t),t}}function openDatabase(){return new Promise(((t,e)=>{const a=indexedDB.open("EPGDatabase",1);a.onerror=t=>e(t.target.error),a.onsuccess=e=>t(e.target.result),a.onupgradeneeded=t=>{t.target.result.createObjectStore("epg",{keyPath:"id"})}}))}function storeEPGData(t,e){return new Promise(((a,o)=>{const r=t.transaction("epg","readwrite");r.objectStore("epg").put({id:"epgData",data:e}),r.oncomplete=()=>a(),r.onerror=t=>o(t.target.error)}))}document.addEventListener("DOMContentLoaded",(async()=>{const t=document.querySelector(".progress-bar"),e=document.querySelector(".message span"),a=localStorage.getItem("previousPage")||"index.html";try{await checkAndUpdateData((e=>{t.style.width=e+"%",t.textContent=e+"%"})),e.textContent="Update completed successfully. Redirecting...",setTimeout((()=>{window.location.href=a}),1e3)}catch(t){console.error("Update error:",t),e.textContent="Failed to update. Please try again later."}}));
